SEL * 
FROM (
		SEL 
		{IBM_STG_TABLE_COLUMNS}
		FROM GTST1T_IBM.{TABLE_NAME} IBM_STG_TABLE
		JOIN (SEL BATCH_ID FROM   DEV_STG_LAYER.OFFLINE_AUDIT_TABLE {MODEL_ID_CONDITION} )IBM_AUDIT_TABLE
		ON  IBM_STG_TABLE.BATCH_ID = IBM_AUDIT_TABLE.BATCH_ID
		{ONLINE_LOAD_ID_CONDITION}
		WHERE IBM_STG_TABLE.REF_KEY NOT IN 
			(
				SEL DISTINCT REF_KEY FROM {source_DB}.{REJ_TABLE_NAME} RJT
				INNER JOIN {source_DB}.{REJ_TABLE_RULE} BRT
				ON RJT.RULE_ID = BRT.RULE_ID
				AND ACTIVE =1 
			)
	QUALIFY ROW_NUMBER() OVER (PARTITION BY {TBL_PKs} ORDER BY IBM_STG_TABLE.BATCH_ID DESC,{QUALIFY_ORDERING},REF_KEY DESC)=1
	UNION ALL
		SEL 
		{TERADATA_STG_TABLE_COLUMNS} 
		FROM {STG_DATABASE}.{TABLE_NAME} TERADATA_STG_TABLE
	)TST
GROUP BY {COUNT_COLS}
HAVING COUNT(*) = 1;